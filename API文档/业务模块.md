## 部署地址

1. 后端
   1. 云端：http://42.193.183.156:8080
   2. 本地：http://192.168.0.200:8080
2. 前端
   1. 云端：http://42.193.183.156:18080
   2. 本地：http://192.168.0.121:18080

## 图文混编方案

https://www.npmjs.com/package/mavon-editor

## 静态资源目录映射

根目录 ： /home/Incubator_Alliance

nginx:

| 映射路径          | 源路径                                   | 资源路径格式                               |
| ----------------- | ---------------------------------------- | ------------------------------------------ |
| /img/             | /home/Incubator_Alliance/img             | /img/article/文章uuid/图片文件名.png       |
| /cover/incubator/ | /home/Incubator_Alliance/cover/incubator | /cover/incubator/孵化器uuid/图片文件名.png |
| /cover/company/   | /home/Incubator_Alliance/cover/company   | /cover/company/公司uuid/图片文件名.png     |

图片上传接口将按照上文图片混编方案中的格式，返回“资源路径格式”的结果

## 部分数据类型说明



1.

2. 日期

   - 数据结构为：

     ```json
     {
         "date":"2021-07-08",
         "month":"2021-07",
         "timeString":"2021-07-08 11:18:59",
         "timestamp":1625714339
     }
     ```

   - 添加或修改时仍需要传递一个对象，但仅需一个字段

   - ```json
     {		
       	"timestamp":1625714339
     }
     ```

   - timestamp字段中数字为 UNIX 秒

## 有效值限定

凡出现以下字段的添加、修改时，其取值应当限定为：

| 字段      | 含义 | 有效值                            |
| --------- | ---- | --------------------------------- |
| 电话/手机 |      | 手机或带区号固话（是否带-号均可） |

## 字段类型说明

- 用户字段：指由用户完全管理（读写）的字段
- 系统字段：由本系统管理的字段，可能不会出现在查询结果中，对用户只读。
- 填充字段：根据该对象的其他字段查询得到的信息，可能不会出现在查询结果中，不存在与数据库表中，对用户只读。

## 用户层级/权限

1. 联盟层：联盟超管、联盟管理员

2. 孵化器层：孵化器超管、孵化器管理员

3. 公司层：公司超管、公司管理员

   

| 权限                      | 联盟超管 | 联盟管理员 | 孵化器超管 | 孵化器管理员 | 公司超管 | 公司管理员 | 注册用户 |
| ------------------------- | -------- | ---------- | ---------- | ------------ | -------- | ---------- | -------- |
| 孵化器：创建              |          |            |            |              |          |            | ✓        |
| 孵化器：修改信息          |          |            | ✓          | ✓            |          |            |          |
| 孵化器：审核（通过&驳回） | ✓        | ✓          |            |              |          |            |          |
| 孵化器：启用&停用         | ✓        | ✓          |            |              |          |            |          |
| 孵化器：查询所有          |          |            |            |              |          |            | 游客     |
| 孵化器：查询我的          |          |            | ✓          | ✓            |          |            |          |
| 孵化器：查询分页          | ✓        | ✓          |            |              |          |            |          |
| 孵化器：查询单个详情      |          |            |            |              |          |            | ✓        |
|                           |          |            |            |              |          |            |          |
| 孵化器用户：申请加入      |          |            |            |              |          |            | ✓        |
| 孵化器用户：同意加入      |          |            | ✓          |              |          |            |          |
| 孵化器用户：移除          |          |            | ✓          |              |          |            |          |
| 孵化器用户：查询分页      | ✓        | ✓          | ✓          | ✓            |          |            |          |
|                           |          |            |            |              |          |            |          |
| 公司：创建                |          |            |            |              |          |            | ✓        |
| 公司：修改信息            |          |            |            |              | ✓        | ✓          |          |
| 公司：审核（通过&驳回）   | ✓        | ✓          |            |              |          |            |          |
| 公司：启用&停用           | ✓        | ✓          |            |              |          |            |          |
| 公司：查询所有            |          |            |            |              |          |            | 游客     |
| 公司：查询我的            |          |            |            |              | ✓        | ✓          |          |
| 公司：查询分页            |          |            |            |              |          |            |          |
| 公司：查询单个详情        |          |            |            |              |          |            | 游客     |
|                           |          |            |            |              |          |            |          |
| 公司用户：申请加入        |          |            |            |              |          |            | ✓        |
| 公司用户：同意加入        |          |            |            |              | ✓        |            |          |
| 公司用户：移除            |          |            |            |              | ✓        |            |          |
| 公司用户：查询分页        |          |            |            |              | ✓        | ✓          |          |
|                           |          |            |            |              |          |            |          |
| 孵化器公司：申请加入      |          |            |            |              | ✓        |            |          |
| 孵化器公司：同意加入      |          |            | ✓          | ✓            |          |            |          |
| 孵化器公司：移除          |          |            | ✓          | ✓            |          |            |          |
|                           |          |            |            |              |          |            |          |
| 文章：添加                | 本层级   | 本层级     | 本层级     | 本层级       | 本层级   | 本层级     |          |
| 文章：修改                | 本层级   | 本层级     | 本层级     | 本层级       | 本层级   | 本层级     |          |
| 文章：镜像                | 本层级   | 本层级     | 本层级     | 本层级       | 本层级   | 本层级     |          |
| 文章：删除                | 本层级   |            | 本层级     |              | 本层级   |            |          |
| 文章：切换轮播            | ✓        | ✓          |            |              |          |            |          |
| 文章：查询分页            |          |            |            |              |          |            | 游客     |
| 文章：单个详情            |          |            |            |              |          |            | 游客     |
| 文章：主页文章列表        |          |            |            |              |          |            | 游客     |
|                           |          |            |            |              |          |            |          |
| 推荐申请：查询收到        | 本层级   | 本层级     | 本层级     | 本层级       |          |            |          |
| 推荐申请：审核            | ✓        | ✓          | ✓          | ✓            |          |            |          |
|                           |          |            |            |              |          |            |          |

## 业务流程

### 孵化器

- 申请创建：填写用户字段，后端补充唯一标识、状态（审核中）、创建人uuid字段。
- 修改信息：根据uuid，修改用户字段。
- 审核通过：根据给出的uuid，把状态从“审核中”修改为“正常”。仅有状态正常的孵化器，其名下文章、企业文章可见。
- 审核驳回：根据给出的uuid和审核意见，把状态从“审核中”修改为“审核不通过”，修改审核意见字段。
- 停用：根据给出的uuid，把状态从“正常”修改为“停用”。
- 启用：根据给出的uuid，把状态从“停用”修改为“正常”。

### 孵化器用户

- 代表某用户属于某孵化器，孵化器审核通过后，申请人自动获得孵化器用户身份，并获得孵化器超管角色
- 申请加入：用户申请加入某孵化器，等待超管确认
- 同意加入：超管同意加入申请，申请人获得孵化器用户身份，并获得孵化器管理员角色
- 移除用户：目标用户移除孵化器用户身份

### 孵化器公司

- 代表某公司属于某孵化器
- 申请加入：公司超管申请加入某孵化器，等待孵化器超管确认
- 同意加入：孵化器超管同意加入申请
- 移除：将公司移除孵化器

### 公司

(与“孵化器”节 相同)

### 公司用户

(与“孵化器用户”节 相同)

### 文章

- 添加文章：提交用户字段创建文章
- 修改文章：提交用户字段修改文章（层级和实体uuid不可修改）,修改成功时后端联动修改其镜像文章的相关字段
- 镜像：提交源文章uuid、目标实体层级、uuid，把源文章镜像到目标实体名下
- 取消镜像：镜像文章视为常规文章，使用删除接口删除

镜像机制：

1. 镜像：把文章引用到非原作者的实体名下，如公司A镜像公司B的文章，孵化器镜像名下公司的文章，联盟镜像孵化器的文章
2. 镜像文章具有“源文章”字段，指向被镜像的源文章
3. 文章推荐机制实际使用镜像机制来实现

### 文章推荐申请

- 提交源文章uuid、目标实体层级、uuid，向目标实体推荐文章
- 列出申请：被申请方的管理员，查询自己收到的申请
- 同意申请：将源文章镜像到目标实体名下，将申请状态设置为“通过”
- 驳回申请：将申请状态设置为“驳回”

## 业务模块

### 实体基础

孵化器和公司均具有以下字段



| 字段                  | 含义             | 数据类型 | 添加时         | 修改时 | 分页查询时 |
| --------------------- | ---------------- | -------- | -------------- | ------ | ---------- |
| (系统字段)            |                  |          |                |        |            |
| uuid                  | 唯一标识         | 字符串   | 后端填写       | 必须   | 无效       |
| status                | 状态             | 字符串   | 后端填写       | 无效   | 等于过滤   |
| creatorUuid           | 创建人uuid       | 字符串   | 后端填写       | 无效   | 无效       |
| reason                | 审核意见         | 字符串   | 驳回审核时填写 |        |            |
| cover                 | 封面图片的文件名 | 字符串   |                |        |            |
| (用户字段)            |                  |          |                |        |            |
| name                  | 名称             | 字符串   | 必须           | 必须   | 关键字过滤 |
| introduction          | 简介             | 字符串   | 必须           | 必须   |            |
| address               | 地址             | 字符串   | 必须           | 必须   | 关键字过滤 |
| contactPerson         | 联系人           | 字符串   | 必须           | 必须   |            |
| phone                 | 电话             | 电话     | 必须           | 必须   |            |
| email                 | 邮箱             | 电子邮箱 | 可选           | 可选   |            |
| mainPage              | 主页             | 字符串   | 可选           | 可选   |            |
| wechatOfficialAccount | 微信公众号名称   | 字符串   | 可选           | 可选   |            |
| (填充字段)            |                  |          |                |        |            |
| creator               | 创建人           | 用户对象 |                |        |            |

### 孵化器

前缀：/Incubator

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| ✓    | ✓    | X    | ✓        | ✓        |

“查询全部”接口包含所有孵化器和其名下企业的 uuid+名称，用于导航，可匿名访问

#### 字段

| 字段       | 含义           | 数据类型     | 添加时   | 修改时 | 分页查询时 |
| ---------- | -------------- | ------------ | -------- | ------ | ---------- |
| (系统字段) |                |              |          |        |            |
| createAt   | 创建时间       | 日期         | 后端填写 | 无效   |            |
| (填充字段) |                |              |          |        |            |
| children   | 孵化器名下企业 | 企业对象数组 |          |        |            |

#### API

##### 查询“我的”孵化器

地址：/mine

孵化器详情信息

##### 审核通过

地址：/pass

params参数：

| 字段 | 含义       |
| ---- | ---------- |
| uuid | 孵化器uuid |

##### 审核驳回

地址：/reject

params参数：

| 字段   | 含义       |
| ------ | ---------- |
| uuid   | 孵化器uuid |
| reason | 审核意见   |

##### 启用

地址：/enable

params参数：

| 字段 | 含义       |
| ---- | ---------- |
| uuid | 孵化器uuid |

##### 停用

地址：/disable

params参数：

| 字段 | 含义       |
| ---- | ---------- |
| uuid | 孵化器uuid |

##### 查询单个详情

地址:/get

params参数：

| 字段 | 含义       |
| ---- | ---------- |
| uuid | 孵化器uuid |

##### 上传和设置封面图

上传封面图到该接口

地址:/setCover

params参数：

| 字段 | 含义       | 必须 |
| ---- | ---------- | ---- |
| uuid | 孵化器uuid | ✓    |



### 孵化器用户

前缀：/IncubatorUser

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| X    | X    | X    | X        | ✓        |

查询分页只会显示当前用户所属的孵化器内的用户

#### 字段

| 字段          | 含义                       | 数据类型 | 分页查询时         |
| ------------- | -------------------------- | -------- | ------------------ |
| (系统字段)    |                            |          |                    |
| uuid          | 唯一标识                   | 字符串   |                    |
| incubatorUuid | 孵化器uuid                 | 字符串   | 非空时为“等于过滤” |
| userUuid      | 用户Uuid                   | 字符串   |                    |
| enable        | 是否生效(同意加入后为true) | 布尔值   | 非空时为“等于过滤” |
| timestamp     | 添加时间                   | 日期     |                    |
| (填充字段)    |                            |          |                    |
| user          | 用户                       | 用户对象 |                    |

#### API

##### 申请加入

地址: /apply

params参数：

| 字段          | 含义       |
| ------------- | ---------- |
| incubatorUuid | 孵化器uuid |

##### 同意加入

地址: /pass

params参数：

| 字段 | 含义 |
| ---- | ---- |
| uuid | uuid |

##### 移除

地址: /del

params参数：

| 字段 | 含义 |
| ---- | ---- |
| uuid | uuid |

### 公司

前缀：/Company

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| ✓    | ✓    | X    | ✓        | ✓        |

#### 字段

| 字段       | 含义     | 数据类型   | 添加时   | 修改时 | 分页查询时 |
| ---------- | -------- | ---------- | -------- | ------ | ---------- |
| (系统字段) |          |            |          |        |            |
| regAt      | 入驻时间 | 日期       | 后端填写 | 无效   |            |
| (填充字段) |          |            |          |        |            |
| parent     | 上级对象 | 孵化器对象 |          |        |            |

#### API

与“孵化器”相同

### 公司用户

前缀：/CompanyUser

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| X    | X    | X    | X        | ✓        |

查询分页只会显示当前用户所属的公司内的用户

#### 字段

| 字段        | 含义                       | 数据类型 | 分页查询时         |
| ----------- | -------------------------- | -------- | ------------------ |
| (系统字段)  |                            |          |                    |
| uuid        | 唯一标识                   | 字符串   |                    |
| companyUuid | 公司uuid                   | 字符串   |                    |
| userUuid    | 用户Uuid                   | 字符串   |                    |
| enable      | 是否生效(同意加入后为true) | 布尔值   | 非空时为“等于过滤” |
| timestamp   | 添加时间                   | 日期     |                    |
| (填充字段)  |                            |          |                    |
| user        | 用户                       | 用户对象 |                    |

#### API

与“孵化器用户”相同

### 孵化器公司

前缀：/IncubatorCompany

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| X    | X    | X    | X        | ✓        |



#### 字段

| 字段          | 含义                       | 数据类型 | 分页查询时         |
| ------------- | -------------------------- | -------- | ------------------ |
| (系统字段)    |                            |          |                    |
| uuid          | 唯一标识                   | 字符串   |                    |
| incubatorUuid | 孵化器uuid                 | 字符串   | 必须               |
| userUuid      | 用户Uuid                   | 字符串   |                    |
| enable        | 是否生效(同意加入后为true) | 布尔值   | 非空时为“等于过滤” |
| timestamp     | 添加时间                   | 日期     |                    |
| (填充字段)    |                            |          |                    |
| company       | 公司                       | 公司对象 |                    |
| name          | 公司名称                   | 字符串   | 按公司名称过滤     |

#### API

##### 申请加入

地址: /apply

params参数：

| 字段          | 含义       |
| ------------- | ---------- |
| incubatorUuid | 孵化器uuid |
| companyUuid   | 公司uuid   |

##### 同意加入

地址: /pass

params参数：

| 字段 | 含义 |
| ---- | ---- |
| uuid | uuid |

##### 移除

地址: /del

params参数：

| 字段 | 含义 | 必须 |
| ---- | ---- | ---- |
| uuid | uuid | ✓    |

### 文章

前缀: /Article

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| ✓    | ✓    | ✓    | X        | ✓        |



#### 字段

| 字段       | 含义           | 数据类型     | 添加时   | 修改时 | 分页查询时 |
| ---------- | -------------- | ------------ | -------- | ------ | ---------- |
| (系统字段) |                |              |          |        |            |
| uuid   | 唯一编号 | 字符串 |  |    |            |
| srcUuid           |   源文章Uuid             | 字符串 |          |        |            |
| authorUuid           |    作者uuid            | 字符串 |          |        |            |
| createDateTime           |   创建日期             | 日期 |          |        |            |
| lastEditDateTime           |  上次修改日期              | 日期 |          |        |            |
| editorUuid           |    编辑者uuid           | 字符串 |          |        |            |
| (用户字段) |              |              |          |        |            |
| level | 实体层级   有效值：{"联盟", "孵化器", "公司"} | 字符串 | 必须 | 无效 | 必须 |
| entityUuid | 实体的uuid | 字符串 | 非联盟时必须 | 无效 | 非联盟时必须 |
| rotation | 是否是轮播文章 | 布尔 |  |  |  |
|            |                |              |          |        |            |
| title | 标题 | 字符串 | 必须 | 可选 | 关键字过滤 |
| content | 正文 | 字符串 | 必须 | 可选 |            |
| type | 文章类型 | 字符串 | 必须 | 可选 | 等于过滤 |
| survey | 是否为联盟概况 | 布尔 | 联盟级文章可选 | 联盟级文章可选 |  |
| surveyIndex | 联盟概况的序号 | 整数 | 联盟级文章可选 | 联盟级文章可选 | |
|  |  |  |  |  | |
| (填充字段) |                |              |          |        |            |
| author           | 作者                                          | 用户对象 |          |        |            |
| attachments | 附件文件名 | 数组 |  |        | |
| editor           | 编辑者                                        | 用户对象 | | | |
| entity           | 实体对象                                      | 实体对象 | | | |

#### API

##### 镜像

地址：/mirror

需要对应层级的镜像权限，且属于目标实体的用户

params参数：

| 字段       | 含义                                            | 必须 |
| ---------- | ----------------------------------------------- | ---- |
| srcUuid    | 源文章uuid                                      | ✓    |
| level      | 目标实体层级 有效值：{"联盟", "孵化器", "公司"} | ✓    |
| entityUuid | 目标实体uuid                                    | ✓    |

##### 查询单个文章详情

地址：/get

params参数：

| 字段 | 含义     | 必须 |
| ---- | -------- | ---- |
| uuid | 文章uuid | ✓    |

##### 主页文章列表

地址：/mainPage

查询指定层级和实体的文章，按类型分组，每个分组按最近编辑时间倒序，取前x条

params参数：

| 字段       | 含义                                            | 必须      |
| ---------- | ----------------------------------------------- | --------- |
| level      | 目标实体层级 有效值：{"联盟", "孵化器", "公司"} | ✓         |
| entityUuid | 目标实体uuid                                    | ✓         |
| count      | 每个分类的文章数量上限                          | X 默认为5 |

##### 上传图片

文章需要先保存一次，拿到uuid之后才能上传图片

地址:/upload

params参数：

| 字段 | 含义     | 必须 |
| ---- | -------- | ---- |
| uuid | 文章uuid | ✓    |

- name字段为文件名

- path字段为访问该图片的路径，需要保证静态资源目录映射已正确配置



##### 删除图片

地址：/deleteFile

params参数：

| 字段     | 含义     | 必须 |
| -------- | -------- | ---- |
| uuid     | 文章uuid | ✓    |
| fileName | 文件名   | ✓    |

##### 查询“联盟概况”文章列表

地址：/survey

查询 survey 字段为true的文章标题，且按surveyIndex字段升序排序；用于“联盟概况”下拉菜单的显示；

##### 切换文章的轮播状态

地址：/switchRotation

params参数：

| 字段 | 含义     | 必须 |
| ---- | -------- | ---- |
| uuid | 文章uuid | ✓    |

##### 查询所有轮播文章

地址：/rotations

提供文章的uuid、标题、附件名，可匿名访问



### 文章推荐申请

前缀：/ArticleMirrorApply

用于下级向上级推荐文章（申请向上级镜像文章）

#### 拥有通用API

| 添加 | 修改 | 删除 | 查询全部 | 查询分页 |
| ---- | ---- | ---- | -------- | -------- |
| X    | X    | X    | X        | X        |

#### 字段

| 字段          | 含义                                            | 数据类型 | 添加时 |
| ------------- | ----------------------------------------------- | -------- | ------ |
| (系统字段)    |                                                 |          |        |
| uuid          | 唯一编号                                        | 字符串   |        |
| status        | 状态（申请中，通过，驳回）                      | 字符串   |        |
| applyUserUuid | 提交申请的用户uuid                              | 字符串   |        |
| level         | 目标实体层级 有效值：{"联盟", "孵化器", "公司"} | 字符串   |        |
| entityUuid    | 目标实体uuid                                    | 字符串   |        |
|               |                                                 |          |        |
| (填充字段)    |                                                 |          |        |
| src           | 源文章                                          | 文章对象 |        |
| entity        | 目标实体对象                                    | 实体对象 |        |

#### API

##### 列出当前用户收到的申请

地址：/list

params参数：

| 字段   | 含义     | 必须 |
| ------ | -------- | ---- |
| status | 申请状态 |      |

##### 列出当前用户提交的申请

地址：/mine

##### 提交申请

地址：/apply

params参数：

| 字段    | 含义       | 必须 |
| ------- | ---------- | ---- |
| srcUuid | 源文章Uuid | ✓    |

##### 通过申请

地址：/pass

params参数：

| 字段 | 含义 | 必须 |
| ---- | ---- | ---- |
| uuid | uuid | ✓    |

##### 驳回申请

地址：/reject

params参数：

| 字段 | 含义 | 必须 |
| ---- | ---- | ---- |
| uuid | uuid | ✓    |
